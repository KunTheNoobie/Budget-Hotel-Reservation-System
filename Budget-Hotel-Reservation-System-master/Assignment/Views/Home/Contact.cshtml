@* 
    Contact Information Page View
    Displays contact information including email, phone, and address.
    Public informational page with company contact details.
*@
@{
    ViewData["Title"] = "Contact Us";
}

<div class="container mt-5 mb-5">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <h1 class="mb-4">Contact Us</h1>
            
            <div class="row mb-4">
                <div class="col-md-6 mb-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title"><i class="bi bi-envelope me-2"></i>Email</h5>
                            <p class="card-text">
                                <a href="mailto:info@budgetstay.com">info@budgetstay.com</a><br>
                                <a href="mailto:support@budgetstay.com">support@budgetstay.com</a>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title"><i class="bi bi-telephone me-2"></i>Phone</h5>
                            <p class="card-text">
                                +60 3-1234 5678<br>
                                Monday - Friday: 9:00 AM - 6:00 PM (MYT)
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-body">
                    <h3 class="mb-3">Send Us a Message</h3>
                    
                    @if (TempData["Success"] != null)
                    {
                        <div class="alert alert-success mb-3">
                            <i class="bi bi-check-circle-fill me-2"></i>@TempData["Success"]
                        </div>
                    }
                    
                    <form id="contactForm" asp-controller="Contact" asp-action="Send" method="post">
                        @Html.AntiForgeryToken()
                        <div class="mb-3">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="name" name="Name" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="Email" required>
                        </div>
                        <div class="mb-3">
                            <label for="subject" class="form-label">Subject</label>
                            <input type="text" class="form-control" id="subject" name="Subject" required>
                        </div>
                        <div class="mb-3">
                            <label for="message" class="form-label">Message</label>
                            <textarea class="form-control" id="message" name="Message" rows="5" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Send Message</button>
                    </form>
                    
                    <script>
                        document.getElementById('contactForm').addEventListener('submit', function(e) {
                            e.preventDefault();
                            var form = this;
                            var formData = new FormData(form);
                            
                            // Get anti-forgery token
                            var token = document.querySelector('input[name="__RequestVerificationToken"]');
                            if (token) {
                                formData.append('__RequestVerificationToken', token.value);
                            }
                            
                            fetch(form.action, {
                                method: 'POST',
                                body: formData,
                                headers: {
                                    'X-Requested-With': 'XMLHttpRequest'
                                }
                            })
                            .then(response => {
                                // Check if response is JSON
                                const contentType = response.headers.get("content-type");
                                if (contentType && contentType.includes("application/json")) {
                                    return response.json();
                                } else {
                                    // If not JSON, might be HTML redirect or error
                                    throw new Error('Unexpected response format');
                                }
                            })
                            .then(data => {
                                if (data && data.success) {
                                    form.reset();
                                    // Remove existing alerts
                                    var existingAlerts = form.parentNode.querySelectorAll('.alert');
                                    existingAlerts.forEach(function(alert) {
                                        alert.remove();
                                    });
                                    // Show success message
                                    var successDiv = document.createElement('div');
                                    successDiv.className = 'alert alert-success mb-3';
                                    successDiv.innerHTML = '<i class="bi bi-check-circle-fill me-2"></i>' + (data.message || 'Your message has been sent successfully! We\'ll get back to you soon.');
                                    form.parentNode.insertBefore(successDiv, form);
                                    // Scroll to top to show message
                                    successDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                                    setTimeout(function() {
                                        successDiv.remove();
                                    }, 5000);
                                } else {
                                    alert(data.message || 'Please fill in all required fields correctly.');
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                // Fallback: submit form normally
                                form.removeEventListener('submit', arguments.callee);
                                form.submit();
                            });
                        });
                    </script>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h3 class="mb-3">Visit Us</h3>
                    <p><strong>Address:</strong></p>
                    <p>123 Jalan Bukit Bintang<br>
                    55100 Kuala Lumpur<br>
                    Malaysia</p>
                    <p class="mt-3"><strong>Business Hours:</strong><br>
                    Monday - Friday: 9:00 AM - 6:00 PM (MYT)<br>
                    Saturday: 10:00 AM - 2:00 PM (MYT)<br>
                    Sunday: Closed</p>
                </div>
            </div>
        </div>
    </div>
</div>

